<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Video Summarizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e7eb 100%);
        }
        .gradient-text {
            background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        .animate-slide-up {
            animation: slideUp 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="min-h-screen py-12 px-4">
    <div class="container mx-auto max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-12 animate-fade-in">
            <h1 class="text-4xl md:text-5xl font-bold mb-4 gradient-text">
                YouTube Video Summarizer
            </h1>
            <p class="text-gray-600 text-lg">
                Transform long videos into concise summaries using AI
            </p>
        </div>

        <!-- Main Content -->
        <div class="space-y-8">
            <!-- Input Section -->
            <div class="glass-effect rounded-2xl shadow-xl p-8 animate-slide-up">
                <div class="space-y-6">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1 relative">
                            <input 
                                type="text" 
                                id="videoUrl" 
                                placeholder="Paste YouTube URL here..."
                                class="w-full px-6 py-4 rounded-xl border-2 border-gray-200 focus:border-blue-500 transition-all duration-300 outline-none text-gray-700 text-lg"
                            >
                        </div>
                        <button 
                            onclick="getSummary()"
                            id="summarizeBtn"
                            class="px-8 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl font-semibold hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed min-w-[160px]"
                        >
                            Summarize
                        </button>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loading" class="hidden animate-fade-in">
                <div class="glass-effect rounded-2xl p-8 text-center">
                    <div class="flex justify-center mb-6">
                        <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
                    </div>
                    <p class="text-gray-600 text-lg" id="processingStatus">
                        Processing your video...
                    </p>
                </div>
            </div>

            <!-- Results Section -->
            <div id="results" class="hidden space-y-6 animate-slide-up">
                <!-- Summary Box -->
                <div class="glass-effect rounded-2xl shadow-xl p-8">
                    <h2 class="text-2xl font-semibold mb-6 text-gray-800 flex items-center">
                        <span class="mr-3">üìù</span> Summary
                    </h2>
                    <div id="summaryText" class="text-gray-700 text-lg leading-relaxed whitespace-pre-wrap"></div>
                </div>

                <!-- Stats Grid -->
                <div class="glass-effect rounded-2xl shadow-xl p-8">
                    <h2 class="text-2xl font-semibold mb-6 text-gray-800 flex items-center">
                        <span class="mr-3">üìä</span> Statistics
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-100">
                            <p class="text-sm text-gray-500 mb-2">Original Length</p>
                            <p class="text-2xl font-bold text-gray-800" id="transcriptLength">-</p>
                        </div>
                        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-100">
                            <p class="text-sm text-gray-500 mb-2">Summary Length</p>
                            <p class="text-2xl font-bold text-gray-800" id="summaryLength">-</p>
                        </div>
                        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-100">
                            <p class="text-sm text-gray-500 mb-2">Processing Time</p>
                            <p class="text-2xl font-bold text-gray-800" id="processingTime">-</p>
                        </div>
                        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-100">
                            <p class="text-sm text-gray-500 mb-2">Reduction Rate</p>
                            <p class="text-2xl font-bold text-gray-800" id="reductionRatio">-</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Error Message -->
            <div id="error" class="hidden animate-fade-in">
                <div class="bg-red-50 border-2 border-red-200 rounded-2xl p-6 text-center">
                    <p class="text-red-600 text-lg" id="errorText"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';

        async function getSummary() {
            const videoUrl = document.getElementById('videoUrl').value.trim();
            if (!videoUrl) {
                showError('Please enter a YouTube URL');
                return;
            }

            hideError();
            showLoading();
            disableInput();

            try {
                console.log('Sending request to:', `${API_URL}/summarize`);
                console.log('Request payload:', { url: videoUrl });

                const response = await fetch(`${API_URL}/summarize`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ url: videoUrl })
                });

                console.log('Response status:', response.status);
                const data = await response.json();
                console.log('Response data:', data);

                if (!response.ok) {
                    throw new Error(data.detail || 'Failed to get summary');
                }

                displayResults(data.data);
            } catch (error) {
                console.error('Error:', error);
                showError(error.message);
            } finally {
                hideLoading();
                enableInput();
            }
        }

        function displayResults(data) {
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('summaryText').textContent = data.summary;
            document.getElementById('transcriptLength').textContent = `${data.stats.transcript_length} words`;
            document.getElementById('summaryLength').textContent = `${data.stats.summary_length} words`;
            document.getElementById('processingTime').textContent = `${data.stats.timing.total_time.toFixed(2)}s`;
            
            const ratio = ((data.stats.summary_length / data.stats.transcript_length) * 100).toFixed(1);
            document.getElementById('reductionRatio').textContent = `${ratio}%`;

            // Scroll to results smoothly
            document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            document.getElementById('errorText').textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function hideError() {
            document.getElementById('error').classList.add('hidden');
        }

        function disableInput() {
            document.getElementById('videoUrl').disabled = true;
            document.getElementById('summarizeBtn').disabled = true;
        }

        function enableInput() {
            document.getElementById('videoUrl').disabled = false;
            document.getElementById('summarizeBtn').disabled = false;
        }

        // Handle Enter key
        document.getElementById('videoUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                getSummary();
            }
        });

        // Test backend connection on load
        window.addEventListener('load', async function() {
            try {
                const response = await fetch(`${API_URL}/test`);
                const data = await response.json();
                console.log('Backend connection test:', data);
            } catch (error) {
                console.error('Backend connection test failed:', error);
            }
        });
    </script>
</body>
</html>